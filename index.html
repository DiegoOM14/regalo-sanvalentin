<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuestra Historia ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@1,400;1,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #d4af37; /* Dorado */
            --bg-dark: #0a0a0a;
            --glass: rgba(20, 20, 20, 0.9);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            background-image: linear-gradient(to bottom, #1a0b1c, #000000);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
            overflow-x: hidden;
        }

        .container {
            background: var(--glass);
            border: 1px solid rgba(212, 175, 55, 0.2);
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.1);
            position: relative;
            transition: opacity 0.5s ease;
        }

        h2 {
            font-family: 'Playfair Display', serif;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            line-height: 1.2;
        }

        p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: #e0e0e0;
        }

        /* INPUTS Y BOTONES */
        input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 1px solid #555;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1.1rem;
            text-align: center;
            outline: none;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        
        /* ESTILO PARA EL CALENDARIO */
        input[type="date"] {
            color-scheme: dark;
            min-height: 50px;
        }

        input:focus { border-color: var(--primary); }

        .btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #d4af37, #aa862e);
            color: #000;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
            width: 100%;
        }
        
        .btn:hover { 
            transform: scale(1.02); 
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        /* FOTOS NIVEL 4 */
        .image-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 500px) {
            .image-grid {
                flex-direction: row;
                justify-content: center;
            }
        }

        .image-option {
            width: 100%;
            max-width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            margin: 0 auto;
        }
        .image-option:hover { 
            transform: scale(1.05); 
            border-color: var(--primary); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        /* ROMPECABEZAS (L√≥gica original de pixeles que te gusta) */
        .puzzle-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 20px auto;
        }

        .puzzle-piece {
            position: absolute;
            width: 100px;
            height: 100px;
            background-size: 300px 300px;
            transition: all 3s ease-in-out; 
            filter: blur(8px); 
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            border-radius: 5px;
        }

        /* Posiciones Grid 3x3 */
        .p0 { top: 0; left: 0; background-position: 0 0; }
        .p1 { top: 0; left: 100px; background-position: -100px 0; }
        .p2 { top: 0; left: 200px; background-position: -200px 0; }
        .p3 { top: 100px; left: 0; background-position: 0 -100px; }
        .p4 { top: 100px; left: 100px; background-position: -100px -100px; }
        .p5 { top: 100px; left: 200px; background-position: -200px -100px; }
        .p6 { top: 200px; left: 0; background-position: 0 -200px; }
        .p7 { top: 200px; left: 100px; background-position: -100px -200px; }
        .p8 { top: 200px; left: 200px; background-position: -200px -200px; }

        /* Estado revelado */
        .puzzle-container.revealed .puzzle-piece {
            filter: blur(0);
            transform: translate(0, 0) rotate(0deg) !important;
            border-radius: 0;
            box-shadow: none;
        }

        /* PISTAS */
        .hint-btn {
            background: none;
            border: none;
            color: #888;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 15px;
        }
        .hint-text {
            color: #d4af37;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
            font-style: italic;
        }

        .necklace-reveal { animation: glow 3s infinite alternate; }
        @keyframes glow {
            from { text-shadow: 0 0 10px #fff, 0 0 20px #d4af37; }
            to { text-shadow: 0 0 20px #fff, 0 0 40px #d4af37; }
        }

        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="musica.mp3" type="audio/mpeg">
    </audio>

    <div class="container" id="game-container"></div>

    <script>
        const levels = [
            // --- INTRO ---
            { type: "intro", title: "Nuestra Historia ‚ù§Ô∏è", text: "He preparado un viaje por nuestros recuerdos para este San Valent√≠n.<br>Hay acertijos f√°ciles, medios y dif√≠ciles.<br><br>¬øLista para empezar?", button: "Comenzar Aventura" },
            
            // --- F√ÅCIL ---
            // AQUI ESTA EL CAMBIO: date-riddle y formato AAAA-MM-DD
            { 
                type: "date-riddle", 
                title: "1. El Comienzo", 
                text: "¬øCu√°ndo nos conocimos? (Selecciona la fecha)", 
                answer: "2021-07-03", 
                hint: "Verano del 21..." 
            },

            { type: "riddle", title: "2. Coordenadas", text: "¬øDonde nos conocimos? Escribe las coordenadas", answer: ["20.388468537095502, -99.95075853896131", "20.388468, -99.950758"], hint: "Solo copia y pega." },
            
            // AQUI TAMBIEN: date-riddle
            { 
                type: "date-riddle", 
                title: "3. Fecha Especial", 
                text: "¬øQu√© d√≠a salimos oficialmente por primera vez?", 
                answer: "2021-12-14", 
                hint: "Cerca de Navidad." 
            },
            
            // FOTOS LARGAS
            {
                type: "image-select",
                title: "4. Primera Foto",
                text: "Selecciona nuestra PRIMERA foto juntos.",
                images: [
                    { src: "foto1.jpg", correct: false }, 
                    { src: "foto2.jpg", correct: true }, 
                    { src: "foto3.jpg", correct: false }
                ],
                hint: "Que pena nos dio JAJA"
            },
            { type: "riddle", title: "5. Melod√≠a", text: "¬øCu√°l fue la primera canci√≥n que te dediqu√©?", answer: "solo por vos", hint: "Tres palabras. ‚ö°" },

            // --- TRANSICI√ìN A MEDIO ---
            { type: "transition", title: "¬°Nivel F√°cil Superado! ü•≥", text: "Tienes buena memoria... Pero ahora vamos a subir un poco la dificultad. <br>¬øEst√°s lista para el Nivel Medio?", button: "Venga, dale" },

            // --- MEDIO ---
            { type: "riddle", title: "6. La Serie", text: "¬øEn qu√© cap√≠tulo vamos de la serie que estamos viendo? (N√∫mero)", answer: "3", hint: "N√∫mero peque√±o." },
            { type: "riddle", title: "7. Suma Segura", text: "Suma: (Tu contrase√±a) + (Mi contrase√±a).", answer: "292138", hint: "Calculadora." },
            { type: "riddle", title: "8. Misi√≥n Cocina", text: "Ve al refri, busca bajo el im√°n grande. Escribe la palabra.", answer: "brillo", hint: "Corre a la cocina." },
            { type: "riddle", title: "9. Gorros", text: "¬øDe qu√© eran nuestros gorros iguales?", answer: "akatsuki", hint: "Nubes rojas." },

            // --- TRANSICI√ìN A DIF√çCIL ---
            { type: "transition", title: "Wow... üòØ", text: "Lo est√°s haciendo incre√≠ble. <br>Ahora respira hondo, porque viene el <b>Nivel Dif√≠cil</b>. <br>Aqu√≠ tendr√°s que investigar de verdad.", button: "Acepto el reto" },

            // --- HARD ---
            {
                type: "blur-riddle", 
                title: "10. Visi√≥n Borrosa",
                text: "Mira esta foto. Est√° desordenada y borrosa.<br>¬øD√≥nde se tom√≥?",
                image: "pavorreales.jpg",
                answer: "la casa de los pavorreales",
                hint: "Tiene nombre de ave ex√≥tica."
            },
            { type: "riddle", title: "11. Las Tazas", text: "Busca debajo de una de esas tazas que compramos con ilusi√≥n para una fecha especial, pero que nunca usamos como planeamos.<br>Escribe la palabra que est√° debajo.", answer: "destino", hint: "Levanta la taza." },
            { type: "riddle", title: "12. WhatsApp", text: "¬øQu√© signfica lo que tengo en mi (About) de WhatsApp?", answer: "a", hint: "Morse" },
            { type: "riddle", title: "13. Cuesti√≥n de Tiempo", text: "Netflix, pel√≠cula 'Cuesti√≥n de Tiempo', minuto 43:15.<br>¬øColor del vestido de ella?", answer: "rojo", hint: "Pasi√≥n." },

            // --- ACERTIJO FINAL EXTRA ---
            { type: "riddle", title: "√öltimo paso...", text: "Para revelar tu regalo, responde esto:<br>Es brillante, se lleva cerca del coraz√≥n y brilla tanto como t√∫.<br>¬øQu√© es?", answer: ["collar", "un collar", "el collar"], hint: "Es una joya." },

            // --- PANTALLA DEL REGALO ---
            { type: "final-gift", title: "Para ti, mi vida üíé", text: "Lo has logrado. Gracias por jugar conmigo.<br><br>Quer√≠a regalarte algo que brillara tanto como tus ojos cuando sonr√≠es.<br><br><b>Busca detras de tu espejo que nunca usaste JAJA. Ah√≠ te espera tu Swarovski.</b><br><br>Te amo.", button: "Te amo ‚ù§Ô∏è" }
        ];

        // --- L√ìGICA DEL SISTEMA ---
        let currentLevel = 0;
        const container = document.getElementById('game-container');
        const audio = document.getElementById('bg-music');

        function loadLevel() {
            const level = levels[currentLevel];
            container.style.opacity = 0;

            setTimeout(() => {
                container.innerHTML = ''; 

                const h2 = document.createElement('h2');
                h2.textContent = level.title;
                if(level.type === 'final-gift') h2.className = 'necklace-reveal';
                container.appendChild(h2);

                // ROMPECABEZAS (L√≥gica original de tu archivo)
                if (level.type === 'blur-riddle') {
                    const pzlCont = document.createElement('div');
                    pzlCont.className = 'puzzle-container';
                    pzlCont.id = 'puzzle-cont';
                    for(let i=0; i<9; i++) {
                        const piece = document.createElement('div');
                        piece.className = `puzzle-piece p${i}`;
                        piece.style.backgroundImage = `url('${level.image}')`;
                        
                        // L√≥gica original de pixeles
                        const randomX = Math.floor(Math.random() * 100 - 50); 
                        const randomY = Math.floor(Math.random() * 100 - 50);
                        const randomRot = Math.floor(Math.random() * 60 - 30); 
                        
                        piece.style.transform = `translate(${randomX}px, ${randomY}px) rotate(${randomRot}deg)`;
                        pzlCont.appendChild(piece);
                    }
                    container.appendChild(pzlCont);
                }

                const p = document.createElement('p');
                p.innerHTML = level.text;
                container.appendChild(p);

                // FOTOS LARGAS (Nivel 4)
                if (level.type === 'image-select') {
                    const grid = document.createElement('div');
                    grid.className = 'image-grid';
                    level.images.forEach(imgInfo => {
                        const img = document.createElement('img');
                        img.src = imgInfo.src;
                        img.className = 'image-option';
                        img.onclick = () => {
                            if(imgInfo.correct) nextLevel();
                            else alert("Esa no es... intenta de nuevo ‚ù§Ô∏è");
                        };
                        grid.appendChild(img);
                    });
                    container.appendChild(grid);
                }

                // INPUTS (Texto, Fechas y Rompecabezas)
                if (level.type === 'riddle' || level.type === 'blur-riddle' || level.type === 'date-riddle') {
                    const input = document.createElement('input');
                    
                    // AQUI SE CREA EL CALENDARIO
                    if (level.type === 'date-riddle') {
                        input.type = 'date';
                        input.style.colorScheme = "dark";
                    } else {
                        input.type = 'text';
                        input.placeholder = 'Respuesta...';
                        input.autocomplete = 'off';
                    }
                    
                    input.id = 'ans';
                    // Enter para enviar
                    input.addEventListener("keypress", (e) => { if(e.key === "Enter") checkAnswer(); });
                    container.appendChild(input);

                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = 'Enviar';
                    btn.onclick = checkAnswer;
                    container.appendChild(btn);

                    if (level.hint) {
                        const hintBtn = document.createElement('button');
                        hintBtn.className = 'hint-btn';
                        hintBtn.textContent = 'Pedir Pista';
                        const hintTxt = document.createElement('div');
                        hintTxt.className = 'hint-text';
                        hintTxt.textContent = level.hint;
                        hintBtn.onclick = () => { hintTxt.style.display = 'block'; hintBtn.style.display = 'none'; };
                        container.appendChild(hintBtn);
                        container.appendChild(hintTxt);
                    }
                }

                if (level.type === 'intro' || level.type === 'transition' || level.type === 'final-gift') {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = level.button;
                    if (level.type === 'intro') {
                        btn.onclick = () => {
                            audio.volume = 0.5; 
                            audio.play().catch(e => console.log("Audio bloqueado"));
                            nextLevel();
                        };
                    } else if (level.type === 'final-gift') {
                        btn.onclick = () => location.reload();
                    } else {
                        btn.onclick = nextLevel;
                    }
                    container.appendChild(btn);
                }

                container.style.opacity = 1;
            }, 500);
        }

        function checkAnswer() {
            const input = document.getElementById('ans');
            const val = input.value.trim(); 
            
            const level = levels[currentLevel];
            let answers = Array.isArray(level.answer) ? level.answer : [level.answer];

            // Verificaci√≥n
            let correct = false;

            // Logica especial para FECHAS
            if (level.type === 'date-riddle') {
                if (answers.includes(val)) correct = true;
            } 
            else if (level.title.includes("Coordenadas")) {
                if (val.includes("20.388") || val.includes("99.95")) correct = true;
            } 
            else {
                // Normalizaci√≥n para texto normal
                const valClean = val.toLowerCase().replace(/,/g, '').normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                const answersClean = answers.map(a => a.toLowerCase().replace(/,/g, '').normalize("NFD").replace(/[\u0300-\u036f]/g, ""));
                if (answersClean.includes(valClean)) correct = true;
            }

            if (correct) {
                if (level.type === 'blur-riddle') {
                    const pzlCont = document.getElementById('puzzle-cont');
                    pzlCont.classList.add('revealed'); 
                    input.style.borderColor = '#00ff00';
                    input.style.display = 'none'; 
                    setTimeout(() => nextLevel(), 3500);
                } else {
                    nextLevel();
                }
            } else {
                input.classList.add('shake');
                input.style.borderColor = '#ff4444';
                setTimeout(() => input.classList.remove('shake'), 500);
            }
        }

        function nextLevel() {
            currentLevel++;
            loadLevel();
        }

        loadLevel();

    </script>
</body>
</html>